<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presentation</title>
    <link rel="stylesheet" type="text/css" href="css/user-style.css">
    <script src = "js/userClient.js"></script>
    <script src = "js/presentationClient.js"></script>
    <script src = "js/inputValidation.js"></script>
</head>

<body>
    <div id="container">
        <div id="startPage">
            <h1 id="startPageTitle">PRESENTATION TOOL</h1>
            <div id="register" class="start">
                <h3>Create a new user account</h3>
                <input type="text" minlength="3" id="inpNameCreate" pattern="[A-Za-z0-9]+" placeholder="Username"><br>
                <input type="email" id="inpEmailCreate" placeholder="E-mail"><br>
                <input type="password" minlength="4" id="inpPasswordCreate" placeholder="Password">
                <br><br>
                <button class="userButtons" id="btnCreate">Create user</button>
                <h3 id="txtResultCreate"></h3>
            </div>

            <div id="login" class="start">
                <h3>Already have an account?<br>Log in here!</h3>
                <input type="text" id="inpNameLogin" placeholder="Username"><br>
                <input type="password" id="inpPasswordLogin" placeholder="Password">
                <br><br>
                <button class="userButtons" id="btnLogin">Login</button>
                <h3 id="txtResultLogin"></h3>
            </div>
        </div>

        <div id="logout" style="display:none">
                <button class="userButtons" id="btnLogout">Logout</button>
        </div>

        <div id="userPage" style="display:none">
            <h2>User profile</h2>
            <div id="update" class="userEdit">
                <h3>Update user</h3>
                <input type="text" minlength="3" id="inpNameUpdate" pattern="[A-Za-z0-9]+" placeholder="Update username"><br>
                <input type="email" id="inpEmailUpdate" placeholder="Update email"><br>
                <input type="text" minlength="4" id="inpPasswordUpdate" placeholder="Update password">
                <br><br>
                <button class="userButtons" id="btnUpdate">Update user</button>
                <h3 id="txtResultUpdate"></h3>
            </div>

            <div id="delete" class="userEdit">
                <button class="userButtons" id="btnDelete">Delete user</button>
                <h3 id="txtResultDelete"></h3>
            </div>
        </div>

    </div>

    <div id="presentation" style="display: none;">
        <div id="createPres">
            <input type="text" minlength="3" id="inpPresNameCreate" pattern="^[A-Za-z0-9\s]+$" placeholder="Presentation name">
            
            <!-- We'll only need more themes later
            <input type="radio" id="defaultThemeCreate" name="themesCreate" value="defaultTheme" checked>
            <label for="defaultThemeCreate">Default Theme</label>
            <input type="radio" id="darkThemeCreate" name="themesCreate" value="darkTheme">
            <label for="darkThemeCreate">Dark Theme</label>
            -->

            <button id="btnCreatePres">Create new presentation!</button>
            <h3 id="txtResultCreatePres"></h3>
        </div>

        <div id="updatePres">
            <input type="text" minlength="3" id="inpPresNameUpdate" pattern="^[A-Za-z0-9\s-]+$" placeholder="Presentation name">
            <button id="btnUpdatePres">Update presentation</button>
            <h3 id="txtResultUpdatePres">
        </div>

        <div id="deletePres">
            <button id="btnDeletePres">Delete presentation</button>
            <h3 id="txtResultDeletePres"></h3>
        </div>
    </div>
    
</body>

<script>

    let startPage = document.getElementById('startPage');
    let userPage = document.getElementById('userPage');
    let logoutDiv = document.getElementById('logout');

    let inpNameCreate = document.getElementById('inpNameCreate');
    let inpEmailCreate = document.getElementById('inpEmailCreate');    
    let inpPasswordCreate = document.getElementById('inpPasswordCreate');
    let btnCreate = document.getElementById('btnCreate');
    let txtResultCreate = document.getElementById('txtResultCreate');

    let inpNameLogin = document.getElementById('inpNameLogin');
    let inpPasswordLogin = document.getElementById('inpPasswordLogin');
    let btnLogin = document.getElementById('btnLogin');
    let txtResultLogin = document.getElementById('txtResultLogin');

    let inpNameUpdate = document.getElementById('inpNameUpdate');
    let inpEmailUpdate = document.getElementById('inpEmailUpdate');    
    let inpPasswordUpdate = document.getElementById('inpPasswordUpdate');
    let btnUpdate = document.getElementById('btnUpdate');
    let txtResultUpdate = document.getElementById('txtResultUpdate');

    let btnDelete = document.getElementById('btnDelete');
    let txtResultDelete = document.getElementById('txtResultDelete');

    let btnLogout = document.getElementById('btnLogout');

    let currentUser = {
        ID: "",
        username: "",
        email: ""
    }

    let inpPresNameCreate = document.getElementById('inpPresNameCreate');
    let btnCreatePres = document.getElementById('btnCreatePres');
    let txtResultCreatePres = document.getElementById('txtResultCreatePres');

    let inpPresNameUpdate = document.getElementById('inpPresNameUpdate');
    let btnUpdatePres = document.getElementById('btnUpdatePres');
    let txtResultUpdatePres = document.getElementById('txtResultUpdatePres');

    let btnDeletePres = document.getElementById('btnDeletePres');
    let txtResultDeletePres = document.getElementById('txtResultDeletePres');

    let currentPres = {
        ID: "",
        owner: "",
        theme: ""
    }

    let presentationClient = new PresentationClient();
    let userClient = new UserClient();
    let inputValidation = new InputValidation();


    //------------------------------------------
    btnCreate.addEventListener('click', function(evt) {
        if(inputValidation.validName(txtResultCreate, inpNameCreate) && inputValidation.validEmail(txtResultCreate,inpEmailCreate) 
            && inputValidation.validPassword(txtResultCreate, inpPasswordCreate)){
            userClient.createUser(txtResultCreate, "/user", inpNameCreate.value, inpEmailCreate.value, inpPasswordCreate.value);
        }
    });
    
    //----------------------------------------
    btnLogin.addEventListener('click', async function(evt){
        let currentData = await userClient.loginUser(txtResultLogin, "/user/auth", inpNameLogin.value, inpPasswordLogin.value);
        if(currentData.msg == `Successfully logged in!`){ //not the best verification
            currentUser.ID = currentData.userID;
            currentUser.username = currentData.userName;
            currentUser.email = currentData.userEmail;
            startPage.style = "display:none";
            userPage.style = "display:flex";
            logoutDiv.style = "display:flex";
        }        
    });

    //---------------------------------------
    btnUpdate.addEventListener('click', function(evt){
        if(inputValidation.validName(txtResultUpdate,inpNameUpdate) && inputValidation.validEmail(txtResultUpdate,inpEmailUpdate)
            && inputValidation.validPassword(txtResultUpdate,inpPasswordUpdate)){
            userClient.updateUser(txtResultUpdate, `/user/${currentUser.ID}`, inpNameUpdate.value, inpEmailUpdate.value, inpPasswordUpdate.value);
        }
    });

    //------------------------------------------
    btnDelete.addEventListener('click', function(evt){
        userClient.deleteUser(txtResultDelete, `/user/${currentUser.ID}`);
    });

    //-----------------------------------------
    btnLogout.addEventListener('click', function(evt){
        currentUser.ID = "";
        currentUser.username = "";
        currentUser.email = "";
        txtResultLogin.innerHTML = "Successfully logged out";
        startPage.style = "display:flex";
        userPage.style = "display:none";
        logoutDiv.style = "display:none";
    });

    //-----------------------------------
    btnCreatePres.addEventListener('click', function(evt){
        //need to figure out how to send the theme as a parameter
    });

    btnUpdatePres.addEventListener('click', function(evt){
        //need to figure out how to send the theme as a parameter
    });

    //-------------------------------------
    btnDeletePres.addEventListener('click', function(evt){
        presentationClient.deletePresentation(txtResultDeletePres, `/presentation/${currentPres.ID}`);
    });

    //--------------------------------------
    function validUsername(txt,username){
        
        if(!username.value){
            txt.innerHTML = "Username is missing";
            return false;
        }
        let validityState = username.validity;
        if(validityState.patternMismatch){
            txt.innerHTML = "Use only letters and digits";
            return false;
        }
        else if(validityState.tooShort){
            txt.innerHTML = "Username must be at least 3 characters long";
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }

    //---------------------------------------
    function validEmail(txt,email){
        
        if(!email.value){
            txt.innerHTML = "Email is missing";
            return false;
        }
        let validityState = email.validity;
        if(!validityState.valid){
            txt.innerHTML = "Wrong email format";
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }

    //--------------------------------------
    function validPassword(txt,password){
        
        if(!password.value){
            txt.innerHTML = "Password is missing";
            return false;
        }
        let validityState = password.validity;
        if(validityState.tooShort){
            txt.innerHTML = "Password must be at least 4 characters long"
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }
</script>

</html>