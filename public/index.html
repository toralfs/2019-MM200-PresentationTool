<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presentation</title>
    <script src = "js/userClient.js"></script>
</head>

<body>
    <div id="register">
        <input type="text" minlength="3" id="inpUserCreate" pattern="[A-Za-z0-9]+" placeholder="Username"><br>
        <input type="email" id="inpEmailCreate" placeholder="E-mail"><br>
        <input type="password" minlength="4" id="inpPasswordCreate" placeholder="Password">
        <br><br>
        <button id="btnCreate">Create user</button>
        <h3 id="txtResultCreate"></h3>
    </div>

    <div id="login">
        <input type="text" id="inpUserLogin" placeholder="Username">
        <input type="password" id="inpPasswordLogin" placeholder="Password">
        <br><br>
        <button id="btnLogin">Login</button>
        <h3 id="txtResultLogin"></h3>
    </div>

    <div id="update">
        <input type="text" minlength="3" id="inpUserUpdate" pattern="[A-Za-z0-9]+" placeholder="Update username">
        <input type="email" id="inpEmailUpdate" placeholder="Update email">
        <input type="password" minlength="4" id="inpPasswordUpdate" placeholder="Update password">
        <br><br>
        <button id="btnUpdate">Update</button>
        <h3 id="txtResultUpdate"></h3>
    </div>

    <div id="delete">
        <button id="btnDelete">Delete</button>
        <h3 id="txtResultDelete"></h3>
    </div>
    
</body>

<script>
    let inpUserCreate = document.getElementById('inpUserCreate');
    let inpEmailCreate = document.getElementById('inpEmailCreate');    
    let inpPasswordCreate = document.getElementById('inpPasswordCreate');
    let btnCreate = document.getElementById('btnCreate');
    let txtResultCreate = document.getElementById('txtResultCreate');

    let inpUserLogin = document.getElementById('inpUserLogin');
    let inpPasswordLogin = document.getElementById('inpPasswordLogin');
    let btnLogin = document.getElementById('btnLogin');
    let txtResultLogin = document.getElementById('txtResultLogin');

    let inpUserUpdate = document.getElementById('inpUserUpdate');
    let inpEmailUpdate = document.getElementById('inpEmailUpdate');    
    let inpPasswordUpdate = document.getElementById('inpPasswordUpdate');
    let btnUpdate = document.getElementById('btnUpdate');
    let txtResultUpdate = document.getElementById('txtResultUpdate');

    let btnDelete = document.getElementById('btnDelete');
    let txtResultDelete = document.getElementById('txtResultDelete');

    let currentUserID = "";

    userClient = new UserClient();

    
    btnCreate.addEventListener('click', function(evt) {
        if(validUsername(txtResultCreate, inpUserCreate) && validEmail(txtResultCreate,inpEmailCreate) 
            && validPassword(txtResultCreate, inpPasswordCreate)){
            userClient.createUser(txtResultCreate, "/user", inpUserCreate.value, inpEmailCreate.value, inpPasswordCreate.value);
        }

    });
    
    btnLogin.addEventListener('click', async function(evt){
        currentUserID = await userClient.loginUser(txtResultLogin, "/user/auth", inpUserLogin.value, inpPasswordLogin.value);
    });

    btnUpdate.addEventListener('click', function(evt){
        if(validUsername(txtResultUpdate,inpUserUpdate) && validEmail(txtResultUpdate,inpEmailUpdate)
            && validPassword(txtResultUpdate,inpPasswordUpdate)){
            userClient.updateUser(txtResultUpdate, `/user/${currentUserID}`, inpUserUpdate, inpEmailUpdate, inpPasswordUpdate);
            console.log(txtResultUpdate.innerHTML);
                //updateUser();
                //NOT WORKING RN!!!!
        }
    });

    btnDelete.addEventListener('click', function(evt){
        userClient.deleteUser(txtResultDelete, `/user/${currentUserID}`);
    });

    //-----------------------------------------
    /*async function updateUser(){ 
        let url = `/user/${currentUserID}`;
        
        let updata = {
            name: inpUserUpdate.value,
            email: inpEmailUpdate.value,
            password: inpPasswordUpdate.value
        }

        let cfg = {
            method: "PUT",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(updata)
        }

        try{
            let resp = await fetch(url, cfg);
            let data = await resp.json();
            txtResultUpdate.innerHTML = data.msg;
            
        }
        catch(err){
            console.log(err);
        }
    }
    */

    //--------------------------------------
    function validUsername(txt,username){
        
        if(!username.value){
            txt.innerHTML = "Username is missing";
            return false;
        }
        let validityState = username.validity;
        if(validityState.patternMismatch){
            txt.innerHTML = "Use only letters and digits";
            return false;
        }
        else if(validityState.tooShort){
            txt.innerHTML = "Username must be at least 3 characters long";
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }

    //---------------------------------------
    function validEmail(txt,email){
        
        if(!email.value){
            txt.innerHTML = "Email is missing";
            return false;
        }
        let validityState = email.validity;
        if(!validityState.valid){
            txt.innerHTML = "Wrong email format";
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }

    //--------------------------------------
    function validPassword(txt,password){
        
        if(!password.value){
            txt.innerHTML = "Password is missing";
            return false;
        }
        let validityState = password.validity;
        if(validityState.tooShort){
            txt.innerHTML = "Password must be at least 4 characters long"
            return false;
        }
        else{
            txt.innerHTML = "";
        }
        return true;
    }
</script>

</html>